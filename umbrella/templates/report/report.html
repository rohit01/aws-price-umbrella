{% extends "layout.html" %}
{% block title %}Report - {{ selected_tag }}{% endblock %}

{% block body %}
  <div class="row">
    <div class="col-sm-6"><h2 align="right">Report based on</h2></div>
    <div class="col-sm-6">
    <form>
      <div class="dropdown">
        <br />
        <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
          {{selected_tag}}
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-center" role="menu" aria-labelledby="dropdownMenu1">
          <li role="presentation" class="disabled"><a role="menuitem" tabindex="-1">{{ selected_tag }}</a></li>
          <li role="presentation" class="divider"></li>
          {% for tag_name in tag_keys %}
            {% if tag_name != selected_tag %}
              <li role="presentation"><a role="menuitem" tabindex="-1" href="/report/{{ tag_name }}">{{ tag_name }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    </form>
    </div>
  </div>

  {% if tag_resources.get(selected_tag, {}).get('instance') %}
  <h2>EC2 Instances</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>{{ selected_tag }}</td>
        {% if selected_tag != 'Name' %}
          <td>Name</td>
        {% endif %}
        <td>Instance ID</td>
        <td>Instance Type</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get(selected_tag, {}).get('instance', []) %}
    <tr>
        <td>{{ details.get('tag:%s' % selected_tag, '-') }}</td>
        {% if selected_tag != 'Name' %}
          <td>{{ details.get('tag:Name', '-') }}</td>
        {% endif %}
        <td>{{ details.get('instance_id', '-') }}</td>
        <td>{{ details.get('instance_type', '-') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get(selected_tag, {}).get('elb') %}
  <h2>Load Balancers (ELB)</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Name</td>
        <td>No. of instances</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get(selected_tag, {}).get('elb', []) %}
    <tr>
        <td>{{ details.get('elb_name', '-') }}</td>
        {% if details.get('elb_instances', '') == '' %}
          <td>0</td>
        {% else %}
          <td>{{ details.get('elb_instances', '').split(',') | length }}</td>
        {% endif %}
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get(selected_tag, {}).get('elastic_ip') %}
  <h2>Elastic IPs</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Elastic IP</td>
        <td>Instance ID</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get(selected_tag, {}).get('elastic_ip', []) %}
    <tr>
        <td>{{ details.get('elastic_ip', '-') }}</td>
        <td>{{ details.get('instance_id', '') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}
  <br />

  <center><h1>Resources Not Tracked</h1></center>
  {% if tag_resources.get('--NOT-TRACKED--', {}).get('instance') %}
  <h2>EC2 Instances</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Name</td>
        <td>Instance ID</td>
        <td>Instance Type</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get('--NOT-TRACKED--', {}).get('instance', []) %}
    <tr>
        <td>{{ details.get('tag:Name', '-') }}</td>
        <td>{{ details.get('instance_id', '-') }}</td>
        <td>{{ details.get('instance_type', '-') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get('--NOT-TRACKED--', {}).get('elb') %}
  <h2>Load Balancers (ELB)</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Name</td>
        <td>No. of instances</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get('--NOT-TRACKED--', {}).get('elb', []) %}
    <tr>
        <td>{{ details.get('elb_name', '-') }}</td>
        {% if details.get('elb_instances', '') == '' %}
          <td>0</td>
        {% else %}
          <td>{{ details.get('elb_instances', '').split(',') | length }}</td>
        {% endif %}
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get('--NOT-TRACKED--', {}).get('elastic_ip') %}
  <h2>Elastic IPs</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Elastic IP</td>
        <td>Instance ID</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get('--NOT-TRACKED--', {}).get('elastic_ip', []) %}
    <tr>
        <td>{{ details.get('elastic_ip', '-') }}</td>
        <td>{{ details.get('instance_id', '') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  <br />
{% endblock %}
