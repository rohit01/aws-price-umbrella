{% extends "layout.html" %}
{% block title %}Report - {{ selected_tag }}{% endblock %}

{% block body %}
  {% if tag_resources.get(selected_tag, {}).get('instance') %}
  <h2>EC2 Instances</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>{{ selected_tag }}</td>
        {% if selected_tag != 'Name' %}
          <td>Name</td>
        {% endif %}
        <td>Instance ID</td>
        <td>State</td>
        <td>Instance Type</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get(selected_tag, {}).get('instance', []) %}
    <tr>
        <td>{{ details.get('tag:%s' % selected_tag, '-') }}</td>
        {% if selected_tag != 'Name' %}
          <td>{{ details.get('tag:Name', '-') }}</td>
        {% endif %}
        <td><a href="{{ url_for('report.instance_details', region=details.get('region', '-'), instance_id=details.get('instance_id', '-')) }}">{{ details.get('instance_id', '-') }}</a></td>
        <td>{{ details.get('state', '-') }}</td>
        <td>{{ details.get('instance_type', '-') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get(selected_tag, {}).get('ebs_volumes') %}
  <h2>EBS Volumes</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>{{ selected_tag }}</td>
        <td>Volume ID</td>
        <td>Size</td>
        <td>Status</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get(selected_tag, {}).get('ebs_volumes', []) %}
    <tr>
        <td>{{ details.get('tag:%s' % selected_tag, '-') }}</td>
        <td><a href="{{ url_for('report.ebs_volume_details', region=details.get('region', '-'), volume_id=details.get('volume_id', '-')) }}">{{ details.get('volume_id', '-') }}</a></td>
        <td>{{ details.get('size', '-') }}</td>
        <td>{{ details.get('status', '-') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get(selected_tag, {}).get('elb') %}
  <h2>Load Balancers (ELB)</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>{{ selected_tag }}</td>
        <td>Name</td>
        <td>No. of instances</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get(selected_tag, {}).get('elb', []) %}
    <tr>
        <td>{{ details.get('tag:%s' % selected_tag, '-') }}</td>
        <td><a href="{{ url_for('report.elb_details', region=details.get('region', '-'), elb_name=details.get('elb_name', '-')) }}">{{ details.get('elb_name', '-') }}</a></td>
        {% if details.get('elb_instances', '') == '' %}
          <td>0</td>
        {% else %}
          <td>{{ details.get('elb_instances', '').split(',') | length }}</td>
        {% endif %}
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get(selected_tag, {}).get('elastic_ip') %}
  <h2>Elastic IPs</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>{{ selected_tag }}</td>
        <td>Elastic IP</td>
        <td>Instance ID</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get(selected_tag, {}).get('elastic_ip', []) %}
    <tr>
        <td>{{ details.get('tag:%s' % selected_tag, '-') }}</td>
        <td><a href="{{ url_for('report.elastic_ip_details', elastic_ip=details.get('elastic_ip', '-')) }}">{{ details.get('elastic_ip', '-') }}</a></td>
        {% if details.get('instance_id', '') == '' %}
          <td>{{ details.get('instance_id', '') }}</td>
        {% else %}
          <td><a href="{{ url_for('report.instance_details', region=details.get('region', '-'), instance_id=details.get('instance_id', '-')) }}">{{ details.get('instance_id', '') }}</a></td>
        {% endif %}
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}
  <br />

  {% if tag_resources.get('--NOT-TRACKED--', None) %}
    <center><h1>Resources Not Tracked</h1></center>
  {% endif %}
  {% if tag_resources.get('--NOT-TRACKED--', {}).get('instance') %}
  <h2>EC2 Instances</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Name</td>
        <td>Instance ID</td>
        <td>State</td>
        <td>Instance Type</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get('--NOT-TRACKED--', {}).get('instance', []) %}
    <tr>
        <td>{{ details.get('tag:Name', '-') }}</td>
        <td><a href="{{ url_for('report.instance_details', region=details.get('region', '-'), instance_id=details.get('instance_id', '-')) }}">{{ details.get('instance_id', '-') }}</a></td>
        <td>{{ details.get('state', '-') }}</td>
        <td>{{ details.get('instance_type', '-') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get('--NOT-TRACKED--', {}).get('ebs_volumes') %}
  <h2>EBS Volumes</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Volume ID</td>
        <td>Size (in GB)</td>
        <td>Status</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get('--NOT-TRACKED--', {}).get('ebs_volumes', []) %}
    <tr>
        <td><a href="{{ url_for('report.ebs_volume_details', region=details.get('region', '-'), volume_id=details.get('volume_id', '-')) }}">{{ details.get('volume_id', '-') }}</a></td>
        <td>{{ details.get('size', '-') }}</td>
        <td>{{ details.get('status', '-') }}</td>
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get('--NOT-TRACKED--', {}).get('elb') %}
  <h2>Load Balancers (ELB)</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Name</td>
        <td>No. of instances</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get('--NOT-TRACKED--', {}).get('elb', []) %}
    <tr>
        <td><a href="{{ url_for('report.elb_details', region=details.get('region', '-'), elb_name=details.get('elb_name', '-')) }}">{{ details.get('elb_name', '-') }}</a></td>
        {% if details.get('elb_instances', '') == '' %}
          <td>0</td>
        {% else %}
          <td>{{ details.get('elb_instances', '').split(',') | length }}</td>
        {% endif %}
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  {% if tag_resources.get('--NOT-TRACKED--', {}).get('elastic_ip') %}
  <h2>Elastic IPs</h2>
  <table class="table table-bordered table-striped">
    <tr class="info">
        <td>Elastic IP</td>
        <td>Instance ID</td>
        <td>Region</td>
    </tr>
    {% for details in tag_resources.get('--NOT-TRACKED--', {}).get('elastic_ip', []) %}
    <tr>
        <td><a href="{{ url_for('report.elastic_ip_details', elastic_ip=details.get('elastic_ip', '-')) }}">{{ details.get('elastic_ip', '-') }}</a></td>
        {% if details.get('instance_id', '') == '' %}
          <td>{{ details.get('instance_id', '') }}</td>
        {% else %}
          <td><a href="{{ url_for('report.instance_details', region=details.get('region', '-'), instance_id=details.get('instance_id', '-')) }}">{{ details.get('instance_id', '') }}</a></td>
        {% endif %}
        <td>{{ details.get('region', '-') }}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  <center><h3>-------------- END --------------</h3></center>
  <br />
  <br />
{% endblock %}
